{
  "version": 3,
  "sources": ["../bip66/index.js"],
  "sourcesContent": ["// Reference https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki\n// Format: 0x30 [total-length] 0x02 [R-length] [R] 0x02 [S-length] [S]\n// NOTE: SIGHASH byte ignored AND restricted, truncate before use\n\nvar Buffer = require('safe-buffer').Buffer\n\nfunction check (buffer) {\n  if (buffer.length < 8) return false\n  if (buffer.length > 72) return false\n  if (buffer[0] !== 0x30) return false\n  if (buffer[1] !== buffer.length - 2) return false\n  if (buffer[2] !== 0x02) return false\n\n  var lenR = buffer[3]\n  if (lenR === 0) return false\n  if (5 + lenR >= buffer.length) return false\n  if (buffer[4 + lenR] !== 0x02) return false\n\n  var lenS = buffer[5 + lenR]\n  if (lenS === 0) return false\n  if ((6 + lenR + lenS) !== buffer.length) return false\n\n  if (buffer[4] & 0x80) return false\n  if (lenR > 1 && (buffer[4] === 0x00) && !(buffer[5] & 0x80)) return false\n\n  if (buffer[lenR + 6] & 0x80) return false\n  if (lenS > 1 && (buffer[lenR + 6] === 0x00) && !(buffer[lenR + 7] & 0x80)) return false\n  return true\n}\n\nfunction decode (buffer) {\n  if (buffer.length < 8) throw new Error('DER sequence length is too short')\n  if (buffer.length > 72) throw new Error('DER sequence length is too long')\n  if (buffer[0] !== 0x30) throw new Error('Expected DER sequence')\n  if (buffer[1] !== buffer.length - 2) throw new Error('DER sequence length is invalid')\n  if (buffer[2] !== 0x02) throw new Error('Expected DER integer')\n\n  var lenR = buffer[3]\n  if (lenR === 0) throw new Error('R length is zero')\n  if (5 + lenR >= buffer.length) throw new Error('R length is too long')\n  if (buffer[4 + lenR] !== 0x02) throw new Error('Expected DER integer (2)')\n\n  var lenS = buffer[5 + lenR]\n  if (lenS === 0) throw new Error('S length is zero')\n  if ((6 + lenR + lenS) !== buffer.length) throw new Error('S length is invalid')\n\n  if (buffer[4] & 0x80) throw new Error('R value is negative')\n  if (lenR > 1 && (buffer[4] === 0x00) && !(buffer[5] & 0x80)) throw new Error('R value excessively padded')\n\n  if (buffer[lenR + 6] & 0x80) throw new Error('S value is negative')\n  if (lenS > 1 && (buffer[lenR + 6] === 0x00) && !(buffer[lenR + 7] & 0x80)) throw new Error('S value excessively padded')\n\n  // non-BIP66 - extract R, S values\n  return {\n    r: buffer.slice(4, 4 + lenR),\n    s: buffer.slice(6 + lenR)\n  }\n}\n\n/*\n * Expects r and s to be positive DER integers.\n *\n * The DER format uses the most significant bit as a sign bit (& 0x80).\n * If the significant bit is set AND the integer is positive, a 0x00 is prepended.\n *\n * Examples:\n *\n *      0 =>     0x00\n *      1 =>     0x01\n *     -1 =>     0xff\n *    127 =>     0x7f\n *   -127 =>     0x81\n *    128 =>   0x0080\n *   -128 =>     0x80\n *    255 =>   0x00ff\n *   -255 =>   0xff01\n *  16300 =>   0x3fac\n * -16300 =>   0xc054\n *  62300 => 0x00f35c\n * -62300 => 0xff0ca4\n*/\nfunction encode (r, s) {\n  var lenR = r.length\n  var lenS = s.length\n  if (lenR === 0) throw new Error('R length is zero')\n  if (lenS === 0) throw new Error('S length is zero')\n  if (lenR > 33) throw new Error('R length is too long')\n  if (lenS > 33) throw new Error('S length is too long')\n  if (r[0] & 0x80) throw new Error('R value is negative')\n  if (s[0] & 0x80) throw new Error('S value is negative')\n  if (lenR > 1 && (r[0] === 0x00) && !(r[1] & 0x80)) throw new Error('R value excessively padded')\n  if (lenS > 1 && (s[0] === 0x00) && !(s[1] & 0x80)) throw new Error('S value excessively padded')\n\n  var signature = Buffer.allocUnsafe(6 + lenR + lenS)\n\n  // 0x30 [total-length] 0x02 [R-length] [R] 0x02 [S-length] [S]\n  signature[0] = 0x30\n  signature[1] = signature.length - 2\n  signature[2] = 0x02\n  signature[3] = r.length\n  r.copy(signature, 4)\n  signature[4 + lenR] = 0x02\n  signature[5 + lenR] = s.length\n  s.copy(signature, 6 + lenR)\n\n  return signature\n}\n\nmodule.exports = {\n  check: check,\n  decode: decode,\n  encode: encode\n}\n"],
  "mappings": "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",
  "names": []
}
